{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/dmaynor/cheddar_framework/schemas/common.schema.json",
  "title": "Cheddar Common Definitions",
  "description": "Shared structures used across all Cheddar artifact types",

  "definitions": {
    "artifact_id": {
      "type": "string",
      "pattern": "^[a-z]+_[a-z0-9_]+_v[0-9]+$",
      "description": "Artifact ID format: {type}_{name}_v{version}",
      "examples": ["mission_qa_excellence_v1", "brief_prkin_v1"]
    },

    "iso8601_timestamp": {
      "type": "string",
      "format": "date-time",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
      "description": "ISO 8601 UTC timestamp",
      "examples": ["2026-01-06T00:00:00Z"]
    },

    "iso8601_date": {
      "type": "string",
      "format": "date",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
      "description": "ISO 8601 date",
      "examples": ["2026-01-06"]
    },

    "sha256_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA-256 hash with prefix",
      "examples": ["sha256:a1b2c3d4e5f6..."]
    },

    "cheddar_state": {
      "type": "string",
      "enum": ["active", "resolved", "stinky"],
      "description": "Artifact lifecycle state"
    },

    "lineage": {
      "type": "object",
      "description": "Cryptographic provenance block",
      "properties": {
        "upstream_hash": {
          "oneOf": [
            { "$ref": "#/definitions/sha256_hash" },
            { "type": "null" }
          ],
          "description": "SHA-256 hash of parent artifact (null for mission)"
        },
        "hash": {
          "$ref": "#/definitions/sha256_hash",
          "description": "SHA-256 hash of this artifact's content"
        },
        "signed_by": {
          "type": "string",
          "description": "Role or identity that signed this artifact"
        },
        "timestamp": {
          "$ref": "#/definitions/iso8601_timestamp",
          "description": "Signing timestamp"
        }
      },
      "required": ["hash", "timestamp"],
      "additionalProperties": false
    },

    "cheddar_stats": {
      "type": "object",
      "description": "Problem detection metrics for documentation logs",
      "properties": {
        "total_cheddars_detected": {
          "type": "integer",
          "minimum": 0,
          "description": "Total problems identified"
        },
        "aligned_cheddars": {
          "type": "integer",
          "minimum": 0,
          "description": "Problems with clear upstream traceability"
        },
        "stinky_cheddars": {
          "type": "integer",
          "minimum": 0,
          "description": "Problems without resolution path"
        }
      },
      "required": ["total_cheddars_detected", "aligned_cheddars", "stinky_cheddars"],
      "additionalProperties": false
    },

    "non_empty_string": {
      "type": "string",
      "minLength": 1
    },

    "non_empty_string_array": {
      "type": "array",
      "items": { "$ref": "#/definitions/non_empty_string" },
      "minItems": 1
    }
  }
}
